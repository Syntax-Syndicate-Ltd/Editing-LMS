{% extends "base.html" %}

{% block content %}
<section class="container mt-5 pt-5">
  <h2 class="fw-bold mb-4 text-center">ðŸ“š Browse Courses</h2>

  {% if courses and courses|length > 0 %}
    <div class="row g-4">
      {% for course in courses %}
        <div class="col-12">
          <div class="card shadow-sm rounded-4 p-4 h-100">
            <h4 class="fw-bold">{{ course.name }}</h4>
            <p class="text-muted">{{ course.description }}</p>

            {% if course.instructor %}
              <p><strong>Instructor:</strong> {{ course.instructor }}</p>
            {% endif %}
            
            {% if course.duration %}
              <p><strong>Duration:</strong> {{ course.duration }}</p>
            {% endif %}

            {% if course.level %}
              <p><strong>Level:</strong> {{ course.level }}</p>
            {% endif %}

            <div class="d-flex justify-content-between align-items-center mt-3">
              <a href="#" class="btn btn-dark rounded-pill">View Details</a>

              {% set enrollment = user_enrollments.get(course._id) %}
              {% if enrollment %}
                {% if enrollment.status == "pending_admin_approval" %}
                  <button class="btn btn-warning rounded-pill" disabled>
                    Pending Approval
                  </button>
                {% elif enrollment.status == "approved" %}
                  <button class="btn btn-success rounded-pill" disabled>
                    Enrolled
                  </button>
                {% elif enrollment.status == "rejected" %}
                  <a href="{{ url_for('request_enrollment', course_id=course._id) }}" class="btn btn-outline-dark rounded-pill">
                    Reapply
                  </a>
                {% endif %}
              {% else %}
                <!-- Redirects to the upload form -->
                <a href="{{ url_for('request_enrollment', course_id=course._id) }}" class="btn btn-outline-dark rounded-pill">
                  Enroll
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-center text-muted">No courses available at the moment. Please check back later.</p>
  {% endif %}
</section>
{% endblock %}
